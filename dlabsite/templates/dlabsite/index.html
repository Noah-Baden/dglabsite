{% load staticfiles %}
<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Comfortaa:300" rel="stylesheet">
    </head>
    <body style="margin:0px 0px; background:black;">
        <div class="canvas-container" style="position:absolute; width:100%; height:100%;">
        </div>
        <div class="load-text" style="position:absolute; z-index:100; top:45%; left:45%">
            <p style="font-family:'Comfortaa',cursive; color:white; font-size:24px;">Loading...</p>
        </div>
        <div style="position:absolute; z-index:100; bottom:5%; left:5%;">
            <p style="font-family:'Comfortaa',cursive; color:white; font-size:72px;">greene lab</p>
            <p style="font-family:'Comfortaa',cursive; color:white; font-size:24px;">coming soon...</p>
        </div>
        <div style="position:absolute; z-index:100; bottom:5%; right:5%;">
            <!--button>Enter Site</button-->
        </div>

        <!-- Javascript -->
        <script
          src="https://code.jquery.com/jquery-3.2.1.min.js"
          integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
          crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/89/three.min.js"></script>
        <script src="{% static 'dlabsite/js/OrbitControls.js' %}"></script>
        <script>


        // Setup renderer
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize($('body').width(),$('body').height());
        $('.canvas-container').append(renderer.domElement);

        // Setup scene
        var scene = new THREE.Scene();

        // Setup camera
        var camera = new THREE.PerspectiveCamera(75,$('body').width()/$('body').height(),0.1,1000);
        camera.position.z = 125;
        var controls = new THREE.OrbitControls(camera);
        controls.autoRotate = true;

        // Make pial geometry for each hemisphere
        $.get('{% url 'dlabsite:load_pial_data' %}', function(data) {
            var left_pial = make_pial_geometry(data['data']);
            var right_pial = make_pial_geometry(data['data2']);
            scene.add(new THREE.Mesh(left_pial,new THREE.MeshNormalMaterial({wireframe:false})));
            scene.add(new THREE.Mesh(right_pial,new THREE.MeshNormalMaterial({wireframe:true})));
            $('.load-text').fadeOut();
        })

        // Render loop
        function animate() {
        	window.requestAnimationFrame(animate);
            controls.update();
            render();
        }
        animate();

        // Render function
        function render() {
            renderer.render(scene,camera);
        }

        // resize renderer and camera on window resize
        $(window).resize(function() {
            camera.aspect = $('body').width()/$('body').height();
            camera.updateProjectionMatrix();
            renderer.setSize($('body').width(),$('body').height());
        });

        // Draw pial surface geometry
        function make_pial_geometry(pialdata) {
            // Setup Geometry
            var geometry = new THREE.Geometry();
            for (var i = 0; i < pialdata.vertices.length; i++) {
                // Define vertices
                geometry.vertices.push(
                    new THREE.Vector3(
                        pialdata.vertices[i][1],
                        pialdata.vertices[i][2],
                        pialdata.vertices[i][0]
                    )
                );
            }
            for (var i = 0; i < pialdata.faces.length; i++) {
                // Define faces
                geometry.faces.push(
                    new THREE.Face3(
                        pialdata.faces[i][1],
                        pialdata.faces[i][2],
                        pialdata.faces[i][0]
                    )
                )
            }
            // compute vertex and face normals
            geometry.computeFaceNormals();
            geometry.computeVertexNormals();

            // return geometry
            return geometry;
        }
        </script>
    </body>
</html>
